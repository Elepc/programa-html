<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visor con Pinch-to-Zoom y Pan</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { width: 100vw; height: 100vh; overflow: hidden; background: black; font-family: sans-serif; }

    .visor { width: 100vw; height: 100vh; position: relative; overflow: hidden; touch-action: none; }

    .contenedor-imagenes {
      display: flex; flex-direction: column; transition: transform 0.6s ease-in-out; height: 100%;
    }

    .slide { width: 100vw; height: 100vh; flex-shrink: 0; position: relative; overflow: hidden; }

    .slide img {
      width: 100%; height: 100%; object-fit: contain; display: block;
      transition: transform 0.2s ease;
      transform-origin: center center;
      touch-action: none;
    }
  </style>
</head>
<body>
  <div class="visor" id="visor">
    <div class="contenedor-imagenes" id="contenedor">
      <div class="slide"><img src="1.png" alt="Imagen 1" /></div>
      <div class="slide"><img src="2.png" alt="Imagen 2" /></div>
      <div class="slide"><img src="3.png" alt="Imagen 3" /></div>
    </div>
  </div>

  <script>
    const contenedor = document.getElementById("contenedor");
    const slides = document.querySelectorAll(".slide");
    let indice = 0;

    // Variables pinch-to-zoom
    let scale = 1;
    let lastScale = 1;
    let startDistance = 0;
    let startX = 0, startY = 0;
    let posX = 0, posY = 0;
    let isDragging = false;

    const visor = document.getElementById("visor");

    function siguiente() { indice = (indice + 1) % slides.length; actualizarSlide(); resetTransform(); }
    function anterior() { indice = (indice - 1 + slides.length) % slides.length; actualizarSlide(); resetTransform(); }

    function actualizarSlide() { contenedor.style.transform = `translateY(-${indice*100}vh)`; }

    function resetTransform() {
      scale = 1; lastScale = 1; posX = 0; posY = 0;
      const img = slides[indice].querySelector('img');
      img.style.transform = `translate(0px,0px) scale(1)`;
    }

    // Gestos
    visor.addEventListener('touchstart', e => {
      if(e.touches.length === 2){
        startDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
      } else if(e.touches.length === 1 && scale > 1){
        isDragging = true;
        startX = e.touches[0].clientX - posX;
        startY = e.touches[0].clientY - posY;
      } else {
        touchStartY = e.touches[0].clientY;
      }
    });

    visor.addEventListener('touchmove', e => {
      e.preventDefault();
      const img = slides[indice].querySelector('img');

      if(e.touches.length === 2){
        // pinch zoom
        let currentDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        scale = lastScale * (currentDistance / startDistance);
        if(scale < 1) scale = 1;
        img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
      } else if(e.touches.length === 1 && scale > 1 && isDragging){
        // pan
        posX = e.touches[0].clientX - startX;
        posY = e.touches[0].clientY - startY;
        img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
      }
    }, {passive:false});

    visor.addEventListener('touchend', e => {
      if(e.touches.length < 2) lastScale = scale;
      isDragging = false;

      // swipe para cambiar slide solo si no estÃ¡ ampliada
      if(scale === 1 && e.changedTouches.length === 1){
        let touchEndY = e.changedTouches[0].clientY;
        const deltaY = touchEndY - touchStartY;
        const umbral = window.innerHeight*0.15;
        if(Math.abs(deltaY) > umbral) deltaY > 0 ? anterior() : siguiente();
      }
    });
  </script>
</body>
</html>
